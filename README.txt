
■ schema_update: データベース定義更新ツール

schema_update はデータベースの更新を簡易化するツールです。

これまでデータベース定義の更新は差分 SQL を適宜適用していましたが、
開発環境やステージング環境、本番環境などのいくつものサーバの
スキーマの状態を正しく把握しながら差分 SQL を適用する必要があり、
管理がややこしくなる原因となっていました。

schema_update では、定義を更新する必要が発生する都度、
パッチ式に差分 SQL を追加していく方式を採っています。
また、データベース上にスキーマのバージョン情報を保持していますので、
どの「差分」まで適用されているのかを自動的に判別し、
差分 SQL を転送し、schema_update を実行するだけでどの環境も一律に
最新のデータベース定義に更新することができます。


利用する際には以下のツールが必要です。

・PHP 5.x
・DB ドライバ
  ・PHP 本体の DB ドライバ
  ・Pear MDB2
  ・以下のコマンドでインストールされる
      pear install mdb2

■ 使い方

(1) 対象のデータベースに対し、db_schema テーブルを作成して下さい。
    (参考: init_mysql.sql)

(2) config.php を適当に編集し schema_update.php と同じディレクトリに設置して下さい。

(3) 差分 SQL を config.php の $sql_dir で指定したディレクトリに追加して下さい。
    差分 SQL は [番号]_....sql というファイル名として下さい。
    (例: 001_create_table.sql)

(4) コマンドプロンプトから以下を実行して下さい。

    % php schema_update.php

